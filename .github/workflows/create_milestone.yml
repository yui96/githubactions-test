name: create_milestones

on:
  issue_comment:
    types: [created]

jobs:
  create:
    if: contains(github.event.comment.html_url, '/issues/') && startsWith(github.event.comment.body, '/create_mlst')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v3
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            const d = new Date();
            const offsetDate = 5;
            d.setDate(d.getDate()+offsetDate);
            
            // 土日だったらスキップさせたほうがいいかも
            
            const yyyy = d.getFullYear();
            const mm = ("0" + d.getMonth()+1).slice(-2);
            const dd = ("0" + d.getDate()).slice(-2);
            const hhs = ["", "_11"]; //詳細な時間忘れた
            const base = yyyy + "_" + mm + "_" + dd;
            const titles = hhs.map((hh)=>{ return base + hh + "_release" });
            console.log(titles);
            
            for(const title of titles){
              github.issues.createMilestone({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: title
              })
            }
